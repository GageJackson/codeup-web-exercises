<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>First Mapbox Map</title>
    <!-- Bootstrap Css -->
    <link href="bootstrap-5.2.3-dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Mapbox JS -->
    <script src="mapbox-gl/dist/mapbox-gl.js"></script>
    <!-- Mapbox CSS -->
    <link href="mapbox-gl/dist/mapbox-gl.css" rel="stylesheet" />
    <style>
      #map {
        /* the width and height may be set to any size */
        width: 100%;
        height: 700px;
      }
    </style>
  </head>
  <body>
    <section class="container">
      <div class="card m-3 bg-primary text-light">
        <div class="card-header">
          <h1>My First Mapbox Map!</h1>
        </div>
        <div id="map" class="card-body"></div>
      </div>

      <!-- The HTML element that serves as the Mapbox container -->
    </section>

    <!-- jQuery -->
    <script src="js/jquery-3.6.3.js"></script>
    <script src="js/keys.js"></script>
    <!-- Mapbox Utils JS -->
    <script src="js/mapbox-geocoder-utils.js"></script>
    <!-- Bootstrap JS -->
    <script src="bootstrap-5.2.3-dist/js/bootstrap.min.js"></script>
    <!-- Custom JS -->
    <script>
      $.ajax("/data/favoriteRestaurants.json").done(function (
        data,
        status,
        jqXhr
      ) {
        createPointsOfInterest(data);
      });

      mapboxgl.accessToken = mapboxKey;
      let map = new mapboxgl.Map({
        container: "map", // container ID
        style: "mapbox://styles/mapbox/streets-v11", // style URL
        zoom: 12, // starting zoom
        center: [-95.275, 32.315], // [lng, lat]
      });

      function createPointsOfInterest(restaurants) {
        restaurants.forEach(function (restaurant, index) {
          // the  geocode method from mapbox-geocoder-utils.js
          geocode(restaurant.address, mapboxKey).then(function (result) {
            //map.setCenter(result);
            //map.setZoom(16);

            let geoMarker = new mapboxgl.Marker().setLngLat(result).addTo(map);
            let geoMarkerPopup = new mapboxgl.Popup().setHTML(
              createPopupHtml()
            );
            geoMarker.setPopup(geoMarkerPopup);
          });
          function createPopupHtml() {
            let html = "<div class='card'>";
            html +=
              "<div class='card-header bg-primary text-light d-flex justify-content-between'>";
            html += "<h5>" + restaurant.name + "</h5>";
            html += "<span>" + restaurant.rating + "</span>" + "</div>";
            html += "<div class='card-body p-0'>";
            html +=
              "<img src=" +
              restaurant.images[0] +
              " alt='text' style='width: 100%; height: 100%'>" +
              "</div>";
            html += "<div class='card-footer'>";
            html += "<p>" + restaurant.description + "</p>";
            html += "<p>5/5</p>" + "</div>";

            return html;
          }
        });
      }

      /* var marker = new mapboxgl.Marker()
        .setLngLat([-95.30066320177026, 32.35079556652797])
        .addTo(map);

      var popup = new mapboxgl.Popup()
        .setLngLat([-95.30066320177026, 32.352])
        .setHTML("<p>Codeup Rocks!</p>")
        .addTo(map);

      var alamoPopup = new mapboxgl.Popup().setHTML(
        "<p>Remember The Alamo!</p>"
      );
      marker.setPopup(alamoPopup);
      // reverse geocode method from mapbox-geocoder-utils.js
      reverseGeocode({ lng: -95.30192, lat: 32.35086 }, mapskey).then(function (
        results
      ) {
        // logs the address for The Alamo
        console.log(results);
      });

       */
    </script>
  </body>
</html>
